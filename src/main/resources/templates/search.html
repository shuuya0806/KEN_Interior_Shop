<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
  <meta charset="UTF-8">
  <title>商品検索結果一覧</title>
  <link th:href="@{/css/common.css}" rel="stylesheet">
  <link th:href="@{/css/header.css}" rel="stylesheet">
  <link th:href="@{/css/item.css}" rel="stylesheet">
  <script th:src="@{/js/main.js}"></script>
  <script th:src="@{/js/item_card.js}"></script>
  <script th:src="@{/js/popup.js}" defer></script>
</head>
<body th:classappend="${isLogin} ? 'logged-in' : ''"  th:data-message="${popupMessage}" th:data-color="${popupColor}">
  <!-- 共通ヘッダー（ログイン状態に応じて表示内容を切り替え） -->
  <header th:insert="~{header :: header_area}"></header>

  <main>
    <div id="wrapper">
      <h1>商品検索結果</h1>

      <!-- フラッシュメッセージ表示領域（カート追加などの通知用） -->
      <div th:if="${message}" class="flash-message">
        <p th:text="${message}"></p>
      </div>

      <!-- 商品検索フォーム（キーワード・カテゴリ・金額による絞り込み） -->
      <div class="item-row">
        <form th:action="@{/search}" method="get">
          <!-- キーワード入力欄（商品名などの部分一致検索） -->
          <input type="text" name="keyword" th:value="${keyword}" placeholder="キーワード入力">

          <!-- カテゴリ選択プルダウン（商品カテゴリによる絞り込み） -->
          <select name="categoryId">
            <option value="">-- 選択してください --</option>
            <option th:each="cat : ${categoryForm}"
                    th:value="${cat.categoryId}"
                    th:text="${cat.categoryName}"
                    th:selected="${cat.categoryId == categoryId}">
            </option>
          </select>

          <!-- 検索ボタン（指定した条件で商品を検索） -->
          <input type="submit" value="検索" class="search-btn">

          <!-- 金額入力欄（最低金額・最高金額を指定、負の値は入力不可） -->
          <div class="price-sort">
            <label for="minPrice">最低金額:
              <input type="number" id="minPrice" name="minPrice" th:value="${minPrice}" min="0" step="100" placeholder="例:1000"/>
            </label>
            <label for="maxPrice">最高金額:
              <input type="number" id="maxPrice" name="maxPrice" th:value="${maxPrice}" min="0" step="100" placeholder="例:10000"/>
            </label>
          </div>
        </form>

        <!-- エラーメッセージ表示領域（不正な検索条件などの警告用） -->
        <div class="note-wrapper">
          <p th:if="${errorMessage}" th:text="${errorMessage}" class="error-message"></p>
        </div>
      </div>

      <!-- 検索結果が0件の場合の情報メッセージ表示領域 -->
      <div class="note-wrapper">
        <p th:if="${infoMessage}" th:text="${infoMessage}"></p>
      </div>

      <!-- 商品一覧表示エリア（検索結果の商品カードを繰り返し表示） -->
      <div class="item-list" th:if="${not #lists.isEmpty(itemForm)}">
        <div class="item-card" th:each="items : ${itemForm}">
          <div class="item-img" th:data-url="@{/item/detail/{id}(id=${items.itemId})}">
            <h3 th:text="${items.itemName}"></h3>
            <img th:src="@{/images/{img}(img=${items.image})}" th:alt="${items.itemName}">
            <p th:text="'¥' + ${items.itemPrice}"></p>
          </div>

          <!-- カート追加フォーム（商品を選択してカートに追加） -->
          <form th:action="@{/cart/add}" method="post">
            <input type="hidden" name="itemId" th:value="${items.itemId}">
            <input type="hidden" name="itemName" th:value="${items.itemName}">
            <input type="hidden" name="itemPrice" th:value="${items.itemPrice}">
            <input type="hidden" name="keyword" th:value="${keyword}">
            <input type="hidden" name="categoryId" th:value="${categoryId}">
            <input type="hidden" name="minPrice" th:value="${minPrice}">
            <input type="hidden" name="maxPrice" th:value="${maxPrice}">
            <input type="hidden" name="redirectUrl"
                   th:value="@{/search(keyword=${keyword}, categoryId=${categoryId}, minPrice=${minPrice}, maxPrice=${maxPrice})}">
            <button type="submit" class="btn">カートに追加</button>

            <!-- 数量選択プルダウン（1〜10の範囲で購入数を指定） -->
            <label for="itemQuantity">数量:</label>
            <select name="itemQuantity" id="itemQuantity">
              <option th:each="i : ${#numbers.sequence(1, 10)}"
                      th:value="${i}" th:text="${i}"></option>
            </select>
          </form>
        </div>
      </div>
    </div>
  </main>
  
  <!-- 共通フッター -->
  <footer th:insert="~{footer :: footer_area}"></footer>
  
</body>
</html>